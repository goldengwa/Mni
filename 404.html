<script>
(function () {
  // 현재 경로 예: /repo-name/@yunha   또는  /@yunha
  var path = location.pathname;

  // 1) 베이스 경로 자동 추출: /404.html, /repo-name/404.html 상황 모두 대응
  //   - '/repo-name/...'이면 base = '/repo-name/'
  //   - 루트면 base = '/'
  var base = path.replace(/\/404\.html.*$/,'/');               // 404.html 직접 호출 대비
  if (!/\/$/.test(base)) base = base + '/';
  // 혹시 404를 /repo-name/404.html 로 불렀다면 base는 '/repo-name/'가 됨

  // 2) 슬러그 추출: /@slug  또는  /slug  (중간에 repo-name 있어도 OK)
  //    repo명은 모른 척하고 맨 끝 세그먼트만 확인하는 방식
  var segs = path.split('/').filter(Boolean);                   // 빈 요소 제거
  var last = segs[segs.length - 1] || '';
  var m = last.match(/^@?([A-Za-z0-9_-]{3,32})$/);
  var slug = m ? m[1] : null;

  // 3) index.html의 "진짜" 위치 계산
  //    - 프로젝트 페이지: /repo-name/index.html
  //    - 루트 페이지:     /index.html
  // base가 '/repo-name/' 같은 형태면 그대로 사용, 루트면 '/'
  var indexUrl = base + 'index.html';

  // 4) slug가 있으면 ?s=slug 로 넘기고, 없으면 그냥 index로
  var target = indexUrl + (slug ? ('?s=' + encodeURIComponent(slug)) : '');

  // 5) 기존 쿼리/해시가 있다면 보존(선택)
  if (location.search) {
    // 이미 ?s= 가 있으면 중복되지 않게 유지
    if (!slug || !/\bs=/.test(location.search)) {
      target += (target.indexOf('?') >= 0 ? '&' : '?') + location.search.slice(1);
    }
  }
  if (location.hash) target += location.hash;

  location.replace(target);
})();
</script>
