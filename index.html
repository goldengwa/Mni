<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>MyNameis</title>
<style>
    :root{ --card-w:360px; }
    *{ box-sizing:border-box }
    body{
      margin:0; padding:0; min-height:100vh;
      font-family:"Pretendard",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      display:flex; justify-content:center; align-items:center;
      background:url("https://img.freepik.com/premium-photo/abstract-background-design-hd-olive-green-color_851755-74064.jpg?semt=ais_hybrid&w=740&q=80") no-repeat center/cover fixed;
      position:relative;
    }
    body::before{ content:""; position:absolute; inset:0; background:rgba(255,255,255,.35); z-index:0 }
    #content,#loading{ position:relative; z-index:1 }

    /* loading */
    #loading{
      position:fixed; inset:0; display:flex; flex-direction:column; gap:10px;
      justify-content:center; align-items:center; background:rgba(239,244,255,.9);
      color:#000; font-size:15px; font-weight:600; z-index:1000;
    }
    .dot-loader{ display:flex; gap:8px; margin-bottom:6px }
    .dot-loader span{ width:12px; height:12px; background:#5865F2; border-radius:50%;
      animation:jump .6s infinite alternate ease-in-out }
    .dot-loader span:nth-child(2){ animation-delay:.2s }
    .dot-loader span:nth-child(3){ animation-delay:.4s }
    @keyframes jump{ from{transform:translateY(0)} to{transform:translateY(-10px)} }

    /* card */
    #content{
      display:none; width:var(--card-w); border-radius:16px; overflow:hidden; background:#fff;
      box-shadow:0 8px 24px rgba(0,0,0,.25); animation:fadeIn 1s ease;
    }
    .card-top{
      background:
        linear-gradient(135deg, rgba(127,90,240,.2), rgba(255,128,191,.2)),
        url("https://img.freepik.com/premium-photo/abstract-background-design-hd-olive-green-color_851755-74064.jpg?semt=ais_hybrid&w=740&q=80") center/cover no-repeat;
      padding:60px 20px 80px; text-align:center; color:#fff; position:relative;
    }
    .card-top img{
      width:110px; height:110px; border-radius:50%; border:4px solid #fff; object-fit:cover;
      box-shadow:0 4px 12px rgba(0,0,0,.3); position:absolute; bottom:-55px; left:50%;
      transform:translateX(-50%); background:#fff;
    }
    .card-bottom{ padding:70px 25px 30px; text-align:center }
    .card-bottom h1{ margin:-5px 0 10px; font-size:24px; font-weight:800; color:#111 }
    .tags{ display:flex; justify-content:center; gap:10px; margin-bottom:15px; flex-wrap:wrap }
    .tag{
      padding:6px 14px; border-radius:20px; font-size:12px; font-weight:700; color:#fff;
      background:#fd0000; box-shadow:0 8px 18px rgba(0,0,0,.15);
      transition: box-shadow .3s ease, transform .2s ease;
    }
    .tag-blue{ background:#c7d2fe } .tag-yellow{ background:#fde68a }
    .tag-pink{ background:#fd8a8a } .tag-gray{ background:#e5e7eb }

    .buttons{ display:flex; flex-direction:column; gap:12px; margin-top:15px }
    .btn{
      display:block; padding:12px 0; text-align:center; font-size:13px; font-weight:700;
      color:#111827; background:#f9fafb; border-radius:8px; text-decoration:none;
      box-shadow:0 2px 6px rgba(0,0,0,.1); transition:all .25s ease; word-break:keep-all;
    }
    .btn:hover{ background:#e5e7eb; transform:scale(1.03) }

    @keyframes fadeIn{ from{opacity:0; transform:translateY(20px)} to{opacity:1; transform:translateY(0)} }

    /* floating buttons */
    .fab{
      position:fixed; right:16px; bottom:16px; z-index:1200; display:flex; gap:8px; align-items:center;
    }
    .fab .settings-toggle, .fab .auth-toggle{
      width:48px; height:48px; border-radius:50%; border:none; cursor:pointer;
      background:#111; color:#fff; font-size:22px; line-height:1; box-shadow:0 8px 24px rgba(0,0,0,.25);
    }
    .auth-toggle{ background:#4b5563; font-size:18px }

    /* settings panel */
    .settings-panel{
      position:fixed; inset:auto 0 0 0; max-height:85vh; background:#fff; z-index:1100;
      border-radius:16px; box-shadow:0 -12px 32px rgba(0,0,0,.18);
      transform:translateY(100%); transition:transform .35s ease;
      border: 1px solid rgba(0,0,0,.04);
      overflow: hidden;
      padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 8px);
    }
    .settings-panel.open{ transform:translateY(0) }
    .sp-head{
      display:flex; align-items:center; justify-content:space-between; gap:8px;
      padding:14px 16px; border-bottom:1px solid #f0f2f5; position:sticky; top:0; background:#fff; z-index:1;
    }
    .sp-title{ font-weight:800; font-size:16px }
    .sp-body{ padding:14px 16px 18px; overflow:auto; max-height:calc(85vh - 56px) }
    .grid{ display:grid; grid-template-columns:1fr; gap:10px }
    .row{ display:grid; grid-template-columns:1fr; gap:8px }
    .row-2{ display:grid; grid-template-columns:1fr 1fr; gap:8px }
    .row-3{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px }
    label{ font-size:12px; font-weight:700; color:#374151 }
    input[type="text"],input[type="url"],input[type="email"],input[type="password"]{
      width:100%; padding:10px 12px; border:1px solid #e5e7eb; border-radius:8px; font-size:14px; background:#fff;
    }
    select{ width:100%; padding:10px 12px; border:1px solid #e5e7eb; border-radius:8px; font-size:14px; background:#fff }
    .list{ display:flex; flex-direction:column; gap:8px }
    .item{ border:1px solid #eef0f3; border-radius:10px; padding:10px; display:grid; gap:8px }
    .item-head{ display:flex; align-items:center; justify-content:space-between; gap:8px }
    .item-actions{ display:flex; gap:6px }
    .btn-small{
      padding:8px 10px; border:1px solid #e5e7eb; border-radius:8px; background:#fff; cursor:pointer; font-weight:700; font-size:12px;
    }
    .btn-primary{ background:#111; color:#fff; border-color:#111 }
    .btn-danger{ background:#fee2e2; border-color:#fecaca; color:#991b1b }
    .btn-ghost{ background:#f9fafb }
    .hr{ height:1px; background:#f0f2f5; margin:10px 0 }
    .actions{ display:flex; gap:8px; flex-wrap:wrap }
    .note{ font-size:12px; color:#6b7280 }
    .color-picker{ margin-top:6px; width:100%; height:40px; padding:0; border:none; }

    /* auth modal */
    .modal{ position:fixed; inset:0; background:rgba(0,0,0,.5); display:none; align-items:center; justify-content:center; z-index:1300 }
    .modal.open{ display:flex }
    .modal-card{ width:min(480px, 92vw); background:#fff; border-radius:12px; box-shadow:0 10px 28px rgba(0,0,0,.25); padding:16px }
    .modal-head{ display:flex; justify-content:space-between; align-items:center; margin-bottom:8px }
    .modal-title{ font-weight:800 }
    .right{ margin-left:auto }
    .pill{ font-size:12px; padding:4px 8px; border-radius:999px; background:#eef2ff; color:#3730a3; }
    .auth-row{ display:grid; grid-template-columns:1fr; gap:8px; margin:8px 0 }
    .auth-actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:8px }
    .login-hint{ font-size:12px; color:#6b7280 }
    @media (min-width: 900px){
      .settings-panel{ left:50%; right:auto; width:560px; margin-left:-280px; border-radius:16px }
      .sp-body{ max-height:calc(85vh - 56px) }
    }
  
/* === Minimal additions === */
#shareLinkBtn, #createShortBtn { display:none !important; }
#bgInput, #bannerInput, #profileInput { display:none !important; }

/* Crop modal */
#cropModal{ position:fixed; inset:0; display:none; z-index:1400; background:rgba(0,0,0,.55); align-items:center; justify-content:center }
#cropBox{ background:#111; color:#fff; width:min(92vw,980px); max-height:90vh; border-radius:12px; box-shadow:0 18px 48px rgba(0,0,0,.35); display:flex; flex-direction:column; overflow:hidden }
#cropHead{ display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px solid rgba(255,255,255,.12); background:#1a1a1a }
#cropTitle{ font-weight:800; font-size:14px } #cropClose{ background:none; border:none; color:#fff; font-size:18px; cursor:pointer }
#cropBody{ padding:12px; background:#111; display:flex; justify-content:center; align-items:center }
#cropStage{ position:relative; width:100%; height:min(64vh,640px); background:#000; display:flex; align-items:center; justify-content:center; overflow:hidden; border-radius:8px }
#cropImg{ max-width:100%; max-height:100%; display:block }
#selBox{ position:absolute; border:2px solid #fff; border-radius:8px; box-shadow:0 0 0 30000px rgba(0,0,0,.45) inset }
.sel-h{ position:absolute; width:14px; height:14px; background:#fff; border-radius:50%; margin:-7px 0 0 -7px; box-shadow:0 2px 6px rgba(0,0,0,.35) }
.sel-h.nw{ left:0; top:0; cursor:nwse-resize } .sel-h.n{ left:50%; top:0; cursor:ns-resize } .sel-h.ne{ left:100%; top:0; cursor:nesw-resize }
.sel-h.e{ left:100%; top:50%; cursor:ew-resize } .sel-h.se{ left:100%; top:100%; cursor:nwse-resize } .sel-h.s{ left:50%; top:100%; cursor:ns-resize }
.sel-h.sw{ left:0; top:100%; cursor:nesw-resize } .sel-h.w{ left:0; top:50%; cursor:ew-resize }
#cropFoot{ display:flex; gap:8px; justify-content:flex-end; padding:12px 16px; border-top:1px solid rgba(255,255,255,.12); background:#1a1a1a }
.crop-btn{ background:#fff; color:#111; border:none; border-radius:8px; font-weight:800; font-size:13px; padding:9px 14px; cursor:pointer }
.crop-btn.secondary{ background:transparent; color:#fff; border:1px solid rgba(255,255,255,.2) }

  </style>
</head>
<body>
<!-- loading -->
<div id="loading">
<div class="dot-loader"><span></span><span></span><span></span></div>
<span id="loadingText">ë¶ˆëŸ¬ì˜¤ê³  ìˆì–´ìš”</span>
</div>
<!-- card -->
<div aria-label="ì†Œê°œ ì¹´ë“œ" id="content" role="main">
<div class="card-top">
<img alt="í”„ë¡œí•„" id="profileImg" src="https://img.freepik.com/premium-photo/abstract-background-design-hd-olive-green-color_851755-74064.jpg?semt=ais_hybrid&amp;w=740&amp;q=80"/>
</div>
<div class="card-bottom">
<h1 id="displayName">ë§ˆì´ ë„¤ì„</h1>
<div class="tags" id="tagsWrap"></div>
<div class="buttons" id="buttonsWrap"></div>
</div>
</div>
<!-- floating buttons -->
<div class="fab">
<button aria-label="ë¡œê·¸ì¸" class="auth-toggle" id="authToggle" title="ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ">ğŸ‘¤</button>
<button aria-label="ì„¤ì •" class="settings-toggle" id="settingsToggle" title="ì„¤ì • ì—´ê¸°/ë‹«ê¸°">âš™ï¸</button>
</div>
<!-- settings panel -->
<aside aria-label="ì„¤ì • íŒ¨ë„" class="settings-panel" id="settingsPanel">
<div class="sp-head">
<div class="sp-title">íŒ¨ë„ ì„¤ì •</div>
<div class="actions">
<span class="pill" id="sessionPill" style="display:none"></span>
<button class="btn-small btn-ghost" id="importBtn">ê°€ì ¸ì˜¤ê¸°</button>
<button class="btn-small btn-ghost" id="exportBtn">ë‚´ë³´ë‚´ê¸°</button>
<button class="btn-small btn-danger" id="resetBtn">ì´ˆê¸°í™”</button>
<button class="btn-small btn-primary" id="saveBtn">ì €ì¥</button>
</div>
</div>
<div class="sp-body">
<div class="grid">
<div class="row-2">
<div>
<label>í˜ì´ì§€ íƒ€ì´í‹€</label>
<input id="titleInput" placeholder="ë¸Œë¼ìš°ì € íƒ­ ì œëª©(ì„ íƒ)" type="text"/>
</div>
<div>
<label>ë¡œë”© ë¬¸êµ¬</label>
<input id="loadingMsgInput" placeholder="ë¶ˆëŸ¬ì˜¤ëŠ” ë™ì•ˆ ë³´ì¼ ë¬¸êµ¬" type="text"/>
</div>
</div>
<div class="row">
<label>ë””ìŠ¤í”Œë ˆì´ ì´ë¦„</label>
<input id="nameInput" placeholder="ì¹´ë“œì— í‘œì‹œí•  ì´ë¦„" type="text"/>
</div>
<div class="row">
<label>ë°°ê²½ ì‚¬ì§„ (íŒŒì¼ ì—…ë¡œë“œë§Œ)</label>
<input id="bgInput" placeholder="íŒŒì¼ ì„ íƒë§Œ ê°€ëŠ¥" readonly="" type="text"/>
<input accept="image/*" class="color-picker" id="bgFile" type="file"/>
</div>
<div class="row">
<label>ë°°ë„ˆ ì‚¬ì§„ (íŒŒì¼ ì—…ë¡œë“œë§Œ)</label>
<input id="bannerInput" placeholder="íŒŒì¼ ì„ íƒë§Œ ê°€ëŠ¥" readonly="" type="text"/>
<input accept="image/*" class="color-picker" id="bannerFile" type="file"/>
</div>
<div class="row">
<label>í”„ë¡œí•„ ì‚¬ì§„ (íŒŒì¼ ì—…ë¡œë“œë§Œ)</label>
<input id="profileInput" placeholder="íŒŒì¼ ì„ íƒë§Œ ê°€ëŠ¥" readonly="" type="text"/>
<input accept="image/*" class="color-picker" id="profileFile" type="file"/>
</div>
<!-- ë¡œë”© ìƒ‰ìƒ -->
<div class="row-2">
<div>
<label>ë¡œë”© ë°°ê²½ ìƒ‰ (CSS Color)</label>
<input id="loadingBgInput" placeholder="rgba(239,244,255,0.9) / #eff4ffcc" type="text"/>
<input class="color-picker" id="loadingBgPicker" type="color"/>
</div>
<div>
<label>ë¡œë”© ê³µ ìƒ‰ (CSS Color)</label>
<input id="loadingDotInput" placeholder="#5865F2 / rgb(88,101,242)" type="text"/>
<input class="color-picker" id="loadingDotPicker" type="color"/>
</div>
</div>
<!-- ë°°ê²½ ì˜¤ë²„ë ˆì´ & ì¹´ë“œ ê·¸ë¦¼ì ìƒ‰ -->
<div class="row-2">
<div>
<label>ë°°ê²½ ì˜¤ë²„ë ˆì´ ìƒ‰ (CSS Color)</label>
<input id="overlayColorInput" placeholder="rgba(255,255,255,0.35) / #ffffff80" type="text"/>
<input class="color-picker" id="overlayColorPicker" type="color"/>
<input id="overlayAlphaRange" type="range" min="0" max="100" value="35" style="width:100%"/>
<div class="note">ì˜¤ë²„ë ˆì´ íˆ¬ëª…ë„: <span id="overlayAlphaVal">35</span>%</div>
<div class="note">íˆ¬ëª…ë„ëŠ” <code>rgba(r,g,b,a)</code> í˜•íƒœ ì¶”ì²œ.</div>
</div>
<div>
<label>ì¹´ë“œ ê·¸ë¦¼ì ìƒ‰ (CSS Color)</label>
<input id="cardShadowColorInput" placeholder="rgba(0,0,0,0.25) / #00000040" type="text"/>
<input class="color-picker" id="cardShadowColorPicker" type="color"/>
<input id="shadowAlphaRange" type="range" min="0" max="100" value="25" style="width:100%"/>
<div class="note">ê·¸ë¦¼ì íˆ¬ëª…ë„: <span id="shadowAlphaVal">25</span>%</div>
</div>
</div>
<div class="hr"></div>
<div class="row">
<label>íƒœê·¸</label>
<div class="list" id="tagsList"></div>
<button class="btn-small" id="addTagBtn">+ íƒœê·¸ ì¶”ê°€</button>
<div class="note">ê·¸ë¦¼ì ìƒ‰ ë¹„ìš°ë©´ íƒœê·¸ ìƒ‰ê³¼ ë™ì¼.</div>
</div>
<div class="hr"></div>
<div class="row">
<label>ë²„íŠ¼</label>
<div class="list" id="linksList"></div>
<button class="btn-small" id="addLinkBtn">+ ë²„íŠ¼ ì¶”ê°€</button>
<div class="note">ë²„íŠ¼ì€ â€œì´ë¦„ + ë§í¬(URL)â€ë§Œ ì…ë ¥.</div>
</div>
<div class="hr"></div>
<!-- ì‚¬ìš©ì ë§í¬(ìŠ¬ëŸ¬ê·¸) ì§€ì • -->
<div class="row">
<label>ì‚¬ìš©ì ë§í¬(ìŠ¬ëŸ¬ê·¸) â€” ì˜ë¬¸/ìˆ«ì/_/-, 3~32ì</label>
<div class="actions">
<input id="slugInput" placeholder="ì˜ˆ: yunha, 0yunha1, my-name" style="flex:1" type="text"/>
<button class="btn-small btn-primary" id="publishSlugBtn">ê²Œì‹œ</button>
</div>
<div class="note">ê³µìœ : <code>https://mynameis.r-e.kr/(ìŠ¬ëŸ¬ê·¸) íŒ¨ë„ ì—…ë°ì´íŠ¸ ì‹œ ë‹¤ì‹œ ê²Œì‹œí•´ì£¼ì„¸ìš”.</code> </div>
</div>
<div class="hr"></div>
<div class="row">
<label>ê³µìœ </label>
<div class="actions">
<button class="btn-small" id="previewBtn">ë¯¸ë¦¬ë³´ê¸° ì ìš©</button>
<button class="btn-small" id="shareLinkBtn">ê³µìœ  ë§í¬ ë§Œë“¤ê¸°</button>
<button class="btn-small btn-primary" id="createShortBtn">ì§§ì€ ë§í¬ ë§Œë“¤ê¸°</button>
<button class="btn-small" id="saveToAccountBtn">ê³„ì •ì— ì €ì¥(í´ë¼ìš°ë“œ)</button>
<button class="btn-small" id="loadFromAccountBtn">ê³„ì •ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
</div>
<div class="note">URLì´ ë„ˆë¬´ ê¸¸ë©´ ìë™ìœ¼ë¡œ ì£¼ì†Œì— ì €ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê³µìœ ëŠ” â€œì§§ì€ ë§í¬â€ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.</div>
</div>
</div>
</div>
</aside>
<!-- templates -->
<template id="tagTpl">
<div class="item tag-item">
<div class="item-head">
<strong>íƒœê·¸</strong>
<div class="item-actions"><button class="btn-small btn-danger tag-del">ì‚­ì œ</button></div>
</div>
<div class="row-2">
<div>
<label>í…ìŠ¤íŠ¸</label>
<input class="tag-text" placeholder="ì˜ˆ: MBTI" type="text"/>
</div>
<div>
<label>ìƒ‰ìƒ</label>
<select class="tag-color">
<option value="tag-blue">íŒŒë‘</option>
<option value="tag-yellow">ë…¸ë‘</option>
<option value="tag-pink">í•‘í¬</option>
<option value="tag-gray">íšŒìƒ‰</option>
</select>
</div>
</div>
<div class="row">
<label>ìƒ‰ìƒ ì½”ë“œ (ì„ íƒ) â€” HEX ë˜ëŠ” rgb/rgba</label>
<input class="tag-color-code" placeholder="#ff5577 ë˜ëŠ” rgb(255,85,119)" type="text"/>
<input class="tag-color-picker color-picker" type="color"/>
</div>
<div class="row">
<label>íƒœê·¸ ê·¸ë¦¼ì ìƒ‰ (ì„ íƒ) â€” ë¹„ìš°ë©´ íƒœê·¸ ìƒ‰ê³¼ ë™ì¼</label>
<input class="tag-shadow-code" placeholder="rgba(0,0,0,0.18) / #c7d2fe" type="text"/>
<input class="tag-shadow-picker color-picker" type="color"/>
</div>
</div>
</template>
<template id="linkTpl">
<div class="item link-item">
<div class="item-head">
<strong>ë²„íŠ¼</strong>
<div class="item-actions"><button class="btn-small btn-danger link-del">ì‚­ì œ</button></div>
</div>
<div class="row">
<label>ë²„íŠ¼ ì´ë¦„</label>
<input class="link-label" placeholder="ì˜ˆ: ì¸ìŠ¤íƒ€ê·¸ë¨" type="text"/>
</div>
<div class="row">
<label>ì—°ê²° ë§í¬(URL)</label>
<input class="link-url" placeholder="https://example.com" type="url"/>
</div>
</div>
</template>
<!-- auth modal -->
<div aria-hidden="true" class="modal" id="authModal">
<div aria-labelledby="authTitle" aria-modal="true" class="modal-card" role="dialog">
<div class="modal-head">
<div class="modal-title" id="authTitle">ë¡œê·¸ì¸ / íšŒì›ê°€ì…</div>
<button class="btn-small btn-ghost" id="authClose">ë‹«ê¸°</button>
</div>
<div class="auth-row">
<label>ì´ë©”ì¼</label>
<input autocomplete="email" id="authEmail" placeholder="you@example.com" type="email"/>
</div>
<div class="auth-row">
<label>ë¹„ë°€ë²ˆí˜¸</label>
<input autocomplete="current-password" id="authPw" placeholder="8ì ì´ìƒ" type="password"/>
</div>
<div class="login-hint">â€» íšŒì›ê°€ì… ì‹œ <b>ì´ë©”ì¼ ì¸ì¦</b>ì´ ì™„ë£Œë˜ì–´ì•¼ ë¡œê·¸ì¸/ë¹„ë²ˆë³€ê²½ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</div>
<div class="auth-actions">
<button class="btn-small" id="sendResetBtn">ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë©”ì¼ ë³´ë‚´ê¸°</button>
<span class="right"></span>
<button class="btn-small btn-primary" id="registerBtn">íšŒì›ê°€ì…(ì¸ì¦ ë©”ì¼)</button>
<button class="btn-small btn-primary" id="loginBtn">ë¡œê·¸ì¸</button>
<button class="btn-small" id="logoutBtn" style="display:none">ë¡œê·¸ì•„ì›ƒ</button>
</div>
</div>
</div>
<!-- password reset modal -->
<div aria-hidden="true" class="modal" id="pwModal">
<div aria-labelledby="pwTitle" aria-modal="true" class="modal-card" role="dialog">
<div class="modal-head">
<div class="modal-title" id="pwTitle">ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •</div>
<button class="btn-small btn-ghost" id="pwClose">ë‹«ê¸°</button>
</div>
<div class="auth-row">
<label>ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
<input id="newPw1" placeholder="8ì ì´ìƒ" type="password"/>
</div>
<div class="auth-row">
<label>ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
<input id="newPw2" placeholder="ë‹¤ì‹œ ì…ë ¥" type="password"/>
</div>
<div class="auth-actions">
<span class="right"></span>
<button class="btn-small btn-primary" id="pwUpdateBtn">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
</div>
</div>
</div>
<!-- Supabase SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    /* ===== Supabase ===== */
    const SUPABASE_URL = "https://jutgrivlikaflkhbdhar.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp1dGdyaXZsaWthZmxraGJkaGFyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxNTk1MTEsImV4cCI6MjA3MTczNTUxMX0.qGsSDiqtzoUYWvWruRGMzzorDVQAO0MLEpIpgX_BpP8";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
if (window.supabase && typeof supabase.auth?.onAuthStateChange === "function" && typeof loadFromAccountRemote === "function") {
  supabase.auth.onAuthStateChange(async (event, session) => {
    if (event === "SIGNED_IN" || event === "TOKEN_REFRESHED") {
      try { await loadFromAccountRemote(); } catch(e) {}
    }
  });
}

    const CLOUD_READY = SUPABASE_URL.startsWith("https://") && !SUPABASE_URL.includes("<YOUR-") && !SUPABASE_ANON_KEY.includes("<YOUR-");
    window.addEventListener("DOMContentLoaded", ()=>{
      if(!CLOUD_READY){
        document.getElementById("authToggle").style.display="none";
        document.getElementById("saveToAccountBtn").style.display="none";
        document.getElementById("loadFromAccountBtn").style.display="none";
        document.getElementById("createShortBtn").style.display="none";
      }
    });
document.addEventListener("DOMContentLoaded", async () => {
  if (!window.supabase || typeof supabase.auth?.getSession !== "function" || typeof loadFromAccountRemote !== "function") return;
  try {
    const { data: { session } } = await supabase.auth.getSession();
    if (session) { await loadFromAccountRemote().catch(()=>{}); }
  } catch {}
});

  </script>
<script>
  /* ===== ê¸°ë³¸ê°’/ìœ í‹¸ ===== */
  const DEFAULTS = {
    pageTitle: "MyNameis",
    loadingText: "ë¶ˆëŸ¬ì˜¤ê³  ìˆì–´ìš”",
    backgroundUrl: "https://img.freepik.com/premium-photo/abstract-background-design-hd-olive-green-color_851755-74064.jpg?semt=ais_hybrid&w=740&q=80",
    bannerUrl:     "https://img.freepik.com/premium-photo/abstract-background-design-hd-olive-green-color_851755-74064.jpg?semt=ais_hybrid&w=740&q=80",
    profileUrl:    "https://img.freepik.com/premium-photo/abstract-background-design-hd-olive-green-color_851755-74064.jpg?semt=ais_hybrid&w=740&q=80",
    name: "ë§ˆì´ë„¤ì„",
    loadingBg: "rgba(239,244,255,0.9)",
    loadingDot: "#5865F2",
    overlayColor: "rgba(255,255,255,0.35)",
    cardShadowColor: "rgba(0,0,0,0.25)",
    tags: [
      { text:"ë§ˆì´ë„¤ì„ì´ì¦ˆ", color:"tag-blue",  shadowColor:"" },
      { text:"ì†Œê°œí˜ì´ì§€",   color:"tag-yellow",shadowColor:"" },
      { text:"ì›¹ì‚¬ì´íŠ¸",     color:"tag-pink",  shadowColor:"" }
    ],
    buttons: []
  };

  const $ = (s, el=document)=> el.querySelector(s);
  const $$ = (s, el=document)=> [...el.querySelectorAll(s)];
  const isSafeUrl = u => /^https?:\/\//i.test(u||"") || /^data:image\/[a-zA-Z]+;base64,/i.test(u||"");
  const isDataImage = u => /^data:image\/[a-zA-Z]+;base64,/i.test(u||"");
  const LS_KEY = "panelConfig.v2";
  const SLUG_KEY = "panel.slug";          // ì €ì¥ëœ ë‚´ ìŠ¬ëŸ¬ê·¸
  const DRAFT_KEY = "panelDraft.v1";      // ì„ì‹œì €ì¥(ì„¸ì…˜)
  const LENGTH_LIMIT = 1800;

  function encodeCfg(cfg){
    const json = JSON.stringify(cfg);
    const bytes = new TextEncoder().encode(json);
    let bin = ""; for (let i=0;i<bytes.length;i++) bin += String.fromCharCode(bytes[i]);
    return btoa(bin);
  }
  function decodeCfg(s){
    try{
      const bin = atob(s);
      const bytes = new Uint8Array([...bin].map(ch=>ch.charCodeAt(0)));
      const json = new TextDecoder().decode(bytes);
      return JSON.parse(json);
    }catch(e){ return null; }
  }
  function cleanCParam(){
    const u = new URL(location.href);
    if(u.searchParams.has("c")){
      u.searchParams.delete("c");
      history.replaceState(null, "", u);
    }
  }

  const HEX_RE = /^#([0-9a-f]{3}|([0-9a-f]{2}){3})$/i;
  const RGB_RE = /^rgba?\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}(?:\s*,\s*(0|1|0?\.\d+))?\s*\)$/i;
  function isCssColor(v){ return HEX_RE.test(v||"") || RGB_RE.test(v||""); }

  function contrastOn(bg){
    let r,g,b;
    if(/^#/.test(bg)){
      let h = bg.slice(1);
      if(h.length===3) h = h.split('').map(c=>c+c).join('');
      const n = parseInt(h, 16);
      r = (n>>16)&255; g = (n>>8)&255; b = (n)&255;
    } else {
      const m = bg.replace(/[^\d.,]/g,"").split(",").map(Number);
      r = m[0]; g = m[1]; b = m[2];
    }
    const L = 0.2126*(r/255) + 0.7152*(g/255) + 0.0722*(b/255);
    return L > 0.6 ? "#111" : "#fff";
  }

  async function copyText(text){
    try{
      if (window.isSecureContext && navigator.clipboard && navigator.clipboard.writeText) {
        await navigator.clipboard.writeText(text);
        return true;
      }
    }catch(e){}
    const ta = document.createElement('textarea');
    ta.value = text; ta.setAttribute('readonly','');
    ta.style.position = 'fixed'; ta.style.top = '-9999px';
    document.body.appendChild(ta);
    ta.focus(); ta.select(); ta.setSelectionRange(0, ta.value.length);
    let ok = false; try{ ok = document.execCommand('copy'); }catch(e){}
    document.body.removeChild(ta);
    return !!ok;
  }

  function applyOverlayColor(color){
    const c = isCssColor(color) ? color : DEFAULTS.overlayColor;
    let s = document.getElementById("overlayOverride");
    if(!s){ s=document.createElement("style"); s.id="overlayOverride"; document.head.appendChild(s); }
    s.textContent = `body::before{background:${c} !important;}`;
  }
  function applyCardShadowColor(color){
    const c = isCssColor(color) ? color : DEFAULTS.cardShadowColor;
    let s = document.getElementById("cardShadowOverride");
    if(!s){ s=document.createElement("style"); s.id="cardShadowOverride"; document.head.appendChild(s); }
    s.textContent = `#content{ box-shadow:0 8px 24px ${c} !important; }`;
  }

  function render(cfg){
    document.title = cfg.pageTitle || cfg.name || document.title;
    $("#loadingText").textContent = cfg.loadingText || DEFAULTS.loadingText;

    const L = $("#loading");
    if (L && cfg.loadingBg)  L.style.background = cfg.loadingBg;
    document.querySelectorAll(".dot-loader span").forEach(s=>{ if(cfg.loadingDot) s.style.background = cfg.loadingDot; });

    document.body.style.backgroundImage = `url("${cfg.backgroundUrl}")`;
    $(".card-top").style.backgroundImage = `
      linear-gradient(135deg, rgba(127,90,240,.2), rgba(255,128,191,.2)),
      url("${cfg.bannerUrl}")
    `;
    $("#profileImg").src = cfg.profileUrl || "";
    $("#displayName").textContent = cfg.name || "";

    const tw = $("#tagsWrap"); tw.innerHTML = "";
    (cfg.tags||[]).forEach(t=>{
      if(!t.text) return;
      const d = document.createElement("div");
      d.className = "tag";
      let bgColor = null;
      if (isCssColor(t.color)) {
        bgColor = t.color;
        d.style.background = bgColor;
      } else {
        d.className = `tag ${t.color || "tag-gray"}`;
      }
      const effectiveBg = bgColor || getComputedStyle(d).backgroundColor;
      d.style.color = contrastOn(effectiveBg);
      const shadow = (t.shadowColor && isCssColor(t.shadowColor)) ? t.shadowColor : effectiveBg;
      d.style.boxShadow = `0 8px 18px ${shadow}`;
      d.textContent = t.text;
      tw.appendChild(d);
    });

    const bw = $("#buttonsWrap"); bw.innerHTML = "";
    (cfg.buttons||[]).forEach(b=>{
      if(!b.label || !isSafeUrl(b.url)) return;
      const a = document.createElement("a"); a.className="btn"; a.target="_blank"; a.rel="noopener";
      a.textContent = b.label; a.href = b.url; bw.appendChild(a);
    });

    applyOverlayColor(cfg.overlayColor);
    applyCardShadowColor(cfg.cardShadowColor);
  }

  /* === ë¡œë”© í™”ë©´ì—ë§Œ ì¦‰ì‹œ ìŠ¤íƒ€ì¼ ì ìš©(ìŠ¬ëŸ¬ê·¸ ë¡œë”© ì§í›„) === */
  function applyLoadingStyle(cfg){
    if(!cfg) return;
    const L = document.getElementById("loading");
    if(!L) return;
    if (cfg.loadingText) {
      const t = document.getElementById("loadingText");
      if (t) t.textContent = cfg.loadingText;
    }
    if (cfg.loadingBg)  L.style.background = cfg.loadingBg;
    if (cfg.loadingDot) {
      document.querySelectorAll(".dot-loader span").forEach(s=> s.style.background = cfg.loadingDot);
    }
  }


/* === Minimal crop modal (fixed aspect; used only on file inputs) === */
(function(){
  const modal = document.getElementById('cropModal');
  const img   = document.getElementById('cropImg');
  const stage = document.getElementById('cropStage');
  const sel   = document.getElementById('selBox');
  const btnClose = document.getElementById('cropClose');
  const btnCancel= document.getElementById('cropCancel');
  const btnApply = document.getElementById('cropApply');

  let aspect = 1, kind = null, onDone = null;
  let nat = {w:0,h:0};
  let box = {x:0,y:0,w:100,h:100}; // selection in STAGE coords (px)
  let start = null;

  function getAspectFor(k){
    if (k==='profile') return 1;
    if (k==='banner'){
      const ct = document.querySelector('.card-top');
      if (ct){ const r=ct.getBoundingClientRect(); if (r.height>0) return r.width/r.height; }
      return 16/9;
    }
    // bg
    return window.innerWidth/Math.max(1,window.innerHeight);
  }
  function openModal(objectURL, k, done){
    kind = k; onDone = done; aspect = getAspectFor(k);
    modal.style.display='flex';
    img.src = objectURL;
    img.onload=()=>{
      nat = {w: img.naturalWidth, h: img.naturalHeight};
      const W = stage.clientWidth, H = stage.clientHeight;
      let w = W*0.7, h = w/aspect;
      if (h > H*0.7){ h = H*0.7; w = h*aspect; }
      box = { x:(W-w)/2, y:(H-h)/2, w, h };
      draw();
    };
    document.addEventListener('keydown', key);
  }
  function closeModal(apply){
    if (apply) applyCrop();
    modal.style.display='none';
    img.src=''; start=null; onDone=null;
    document.removeEventListener('keydown', key);
  }
  function key(e){ if(e.key==='Escape') closeModal(false); if(e.key==='Enter') closeModal(true); }

  function draw(){
    sel.style.left = box.x + 'px';
    sel.style.top  = box.y + 'px';
    sel.style.width  = box.w + 'px';
    sel.style.height = box.h + 'px';
  }
  function clamp(){
    const W = stage.clientWidth, H = stage.clientHeight;
    if (box.x < 0) box.x = 0;
    if (box.y < 0) box.y = 0;
    if (box.x + box.w > W) box.x = W - box.w;
    if (box.y + box.h > H) box.y = H - box.h;
  }

  sel.addEventListener('pointerdown', (e)=>{
    const dir = e.target.dataset?.dir || '';
    start = {dir, x0:e.clientX, y0:e.clientY, ...box};
    sel.setPointerCapture(e.pointerId);
    e.preventDefault();
  });
  sel.addEventListener('pointermove', (e)=>{
    if(!start) return;
    const dx = e.clientX - start.x0, dy = e.clientY - start.y0;
    let {x,y,w,h} = start;
    if (!start.dir){ x += dx; y += dy; }
    else{
      // fixed aspect resize
      if (start.dir.includes('e')||start.dir.includes('w')){ w = start.w + (start.dir.includes('e')?dx:-dx); h = w/aspect; if(start.dir.includes('n')) y = start.y + (start.h-h); }
      if (start.dir.includes('n')||start.dir.includes('s')){ h = start.h + (start.dir.includes('s')?dy:-dy); w = h*aspect; if(start.dir.includes('w')) x = start.x + (start.w-w); }
    }
    box = { x, y, w:Math.max(40,w), h:Math.max(40,h) }; clamp(); draw();
  });
  sel.addEventListener('pointerup', ()=>{ start=null; });

  btnClose.addEventListener('click', ()=>closeModal(false));
  btnCancel.addEventListener('click', ()=>closeModal(false));
  btnApply.addEventListener('click', ()=>closeModal(true));

  function applyCrop(){
    if (!nat.w || !nat.h || !onDone) return;
    // selection in IMAGE pixels
    const stageRect = stage.getBoundingClientRect();
    const imgRect = img.getBoundingClientRect();
    const selLeft = stageRect.left + box.x;
    const selTop  = stageRect.top  + box.y;
    const offX = selLeft - imgRect.left;
    const offY = selTop  - imgRect.top;
    const scaleX = nat.w / Math.max(1, imgRect.width);
    const scaleY = nat.h / Math.max(1, imgRect.height);
    const sx = Math.max(0, offX * scaleX);
    const sy = Math.max(0, offY * scaleY);
    const sw = Math.max(1, box.w * scaleX);
    const sh = Math.max(1, box.h * scaleY);

    const canvas = document.createElement('canvas');
    canvas.width = Math.round(sw);
    canvas.height= Math.round(sh);
    const ctx = canvas.getContext('2d');
    ctx.imageSmoothingQuality = 'high';
    ctx.drawImage(img, Math.round(sx), Math.round(sy), Math.round(sw), Math.round(sh), 0,0, canvas.width, canvas.height);
    const dataURL = canvas.toDataURL('image/jpeg', 0.92);
    try{ onDone(dataURL); }catch{}
  }

  // expose
  window.__openCrop = openModal;
})();


  /* ===== ê°•ë ¥ ë¡œë”© ì»¨íŠ¸ë¡¤ëŸ¬ (ìµœì†Œ í‘œì‹œ + ìµœì¥ íƒ€ì„ì•„ì›ƒ) ===== */
  (function(){
    const L = document.getElementById("loading");
    const C = document.getElementById("content");
    let closed = false;

    const MIN_SHOW = 2000;   // ìµœì†Œ 2ì´ˆëŠ” ë¡œë”© ìœ ì§€
    const HARD_MAX = 5000;  // 5ì´ˆ ì•ˆì—ëŠ” ë¬´ì¡°ê±´ ë‹«ê¸°
    const shownAt  = Date.now();

    function reallyClose(){
      if (closed) return;
      try { if (L) L.style.display = "none"; if (C) C.style.display = "block"; } catch(e){}
      closed = true;
    }

    window.__closeLoading = function(){
      const elapsed = Date.now() - shownAt;
      const EXTRA_DELAY = 1800;  // ì‚¬ìš©ì ìš”ì²­: ê³„ì • ì„¤ì •ì´ ì ìš©ëœ ë’¤ì—ë„ 3ì´ˆëŠ” ë” ë³´ì—¬ì£¼ê¸°
      const wait = Math.max(MIN_SHOW - elapsed, 0) + EXTRA_DELAY;
      setTimeout(reallyClose, wait);
    };

    setTimeout(window.__closeLoading, HARD_MAX);
    window.addEventListener("unhandledrejection", () => setTimeout(window.__closeLoading, 0));
  })();

  /* ====== DOM ë°”ì¸ë”© ====== */
  const panel=$("#settingsPanel"), toggleBtn=$("#settingsToggle"), authToggle=$("#authToggle"), sessionPill=$("#sessionPill");
  const titleInput=$("#titleInput"), loadingMsgInput=$("#loadingMsgInput"), nameInput=$("#nameInput"),
        bgInput=$("#bgInput"), bannerInput=$("#bannerInput"), profileInput=$("#profileInput"),
        loadingBgInput=$("#loadingBgInput"), loadingDotInput=$("#loadingDotInput"),
        tagsList=$("#tagsList"), linksList=$("#linksList");
  const bgFile=$("#bgFile"), bannerFile=$("#bannerFile"), profileFile=$("#profileFile");
  const loadingBgPicker=$("#loadingBgPicker"), loadingDotPicker=$("#loadingDotPicker");
  const overlayColorInput=$("#overlayColorInput"), overlayColorPicker=$("#overlayColorPicker");
  const cardShadowColorInput=$("#cardShadowColorInput"), cardShadowColorPicker=$("#cardShadowColorPicker");

  // === Slider wiring (overlay/shadow alpha) ===
  (function(){
    function __parseRGBA(c){
      c = (c||"").trim();
      if(/^#/.test(c)){
        let h = c.slice(1); if(h.length===3) h = h.split('').map(x=>x+x).join('');
        const n = parseInt(h,16); return [(n>>16)&255,(n>>8)&255,(n)&255,1];
      }
      const m = c.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(?:\s*,\s*(0|1|0?\.\d+))?\s*\)/i);
      if(m) return [parseInt(m[1]),parseInt(m[2]),parseInt(m[3]), m[4]!==undefined?parseFloat(m[4]):1];
      return [255,255,255,1];
    }
    function __rgbaStr([r,g,b,a]){ return `rgba(${r},${g},${b},${Math.max(0,Math.min(1,a))})`; }
    function __setAlpha(color, pct){ const v=__parseRGBA(color); v[3]=Math.max(0,Math.min(1,pct/100)); return __rgbaStr(v); }

    const overlayAlphaRange = document.getElementById('overlayAlphaRange');
    const overlayAlphaVal = document.getElementById('overlayAlphaVal');
    const shadowAlphaRange = document.getElementById('shadowAlphaRange');
    const shadowAlphaVal = document.getElementById('shadowAlphaVal');

    function syncOverlayAlpha(){
      if (!overlayAlphaRange) return;
      const base = overlayColorInput.value.trim() || DEFAULTS.overlayColor;
      overlayAlphaVal.textContent = overlayAlphaRange.value;
      overlayColorInput.value = __setAlpha(base, parseInt(overlayAlphaRange.value,10));
      render(collectForm()); saveDraftDebounced();
    }
    function syncShadowAlpha(){
      if (!shadowAlphaRange) return;
      const base = cardShadowColorInput.value.trim() || DEFAULTS.cardShadowColor;
      shadowAlphaVal.textContent = shadowAlphaRange.value;
      cardShadowColorInput.value = __setAlpha(base, parseInt(shadowAlphaRange.value,10));
      render(collectForm()); saveDraftDebounced();
    }
    if (overlayAlphaRange){ overlayAlphaRange.addEventListener('input', syncOverlayAlpha); }
    if (shadowAlphaRange){ shadowAlphaRange.addEventListener('input', syncShadowAlpha); }
    if (overlayAlphaRange){
      const a = Math.round((__parseRGBA(overlayColorInput.value||DEFAULTS.overlayColor)[3]||1)*100);
      overlayAlphaRange.value = a; overlayAlphaVal.textContent = a;
    }
    if (shadowAlphaRange){
      const a2 = Math.round((__parseRGBA(cardShadowColorInput.value||DEFAULTS.cardShadowColor)[3]||1)*100);
      shadowAlphaRange.value = a2; shadowAlphaVal.textContent = a2;
    }
  })();

  const slugInput = document.getElementById("slugInput");

  function openPanel(o=true){ panel.classList.toggle("open", o) }

  /* ===== ìë™ ì„ì‹œì €ì¥(ìƒˆë¡œê³ ì¹¨/íƒ­ ì „í™˜ ë³µêµ¬ìš©) ===== */
  const saveDraftDebounced = debounce(()=> {
    try{
      const draft = { cfg: collectForm(), panelOpen: panel.classList.contains("open"), ts: Date.now() };
      sessionStorage.setItem(DRAFT_KEY, JSON.stringify(draft));
    }catch{}
  }, 400);

  function maybeRestoreDraft(){
    try{
      const raw = sessionStorage.getItem(DRAFT_KEY);
      if(!raw) return;
      const draft = JSON.parse(raw);
      if(!draft || !draft.cfg) return;
      // ë·°ì–´ê°€ ì•„ë‹ˆë¼ "í¸ì§‘ì¤‘" ì˜ë„ë¥¼ ì¡´ì¤‘: panelOpenì´ trueì˜€ì„ ë•Œë§Œ ë³µêµ¬
      if (draft.panelOpen){
        fillForm(draft.cfg);
        render(draft.cfg);
        openPanel(true);
      }
    }catch{}
  }

  function clearDraft(){ try{ sessionStorage.removeItem(DRAFT_KEY); }catch{} }

  function debounce(fn, ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); }; }

  // íŒ¨ë„ í† ê¸€
  toggleBtn.addEventListener("click", ()=>{
    if (!currentUser) { alert("íŒ¨ë„ì„ ì—´ê¸° ì „ì— ë¡œê·¸ì¸/íšŒì›ê°€ì…(ì´ë©”ì¼ ì¸ì¦)í•´ì£¼ì„¸ìš”."); openAuth(true); return; }
    const savedSlug = localStorage.getItem(SLUG_KEY);
    if (savedSlug) slugInput.value = savedSlug;
    openPanel(!panel.classList.contains("open"));
    saveDraftDebounced();
  });

  // ì…ë ¥ ë³€í™” â†’ ì„ì‹œì €ì¥
  panel.addEventListener("input", saveDraftDebounced);
  panel.addEventListener("change", saveDraftDebounced);
  panel.addEventListener("click", (e)=>{
    if (e.target.matches(".tag-del,.link-del,#addTagBtn,#addLinkBtn")) {
      setTimeout(saveDraftDebounced, 0);
    }
  });

  function fileToDataURL(file, cb){ const r=new FileReader(); r.onload=()=>cb(r.result); r.readAsDataURL(file); }

  function addTagRow(tag={text:"", color:"tag-gray", shadowColor:""}){
    const tpl = document.getElementById("tagTpl").content.cloneNode(true);
    const row = tpl.querySelector(".tag-item");

    const inpText   = row.querySelector(".tag-text");
    const selClass  = row.querySelector(".tag-color");
    const inpCode   = row.querySelector(".tag-color-code");
    const pickCode  = row.querySelector(".tag-color-picker");
    const inpShadow = row.querySelector(".tag-shadow-code");
    const pickShadow= row.querySelector(".tag-shadow-picker");

    inpText.value = tag.text || "";
    if (isCssColor(tag.color)) { inpCode.value = tag.color; }
    else { selClass.value = tag.color || "tag-gray"; inpCode.value = ""; }
    inpShadow.value = tag.shadowColor || "";

    row.querySelector(".tag-del").addEventListener("click", ()=> row.remove());
    pickCode.addEventListener("input", e=>{ inpCode.value = e.target.value; render(collectForm()); saveDraftDebounced(); });
    pickShadow.addEventListener("input", e=>{ inpShadow.value = e.target.value; render(collectForm()); saveDraftDebounced(); });

    tagsList.appendChild(tpl);
  }

  function addLinkRow(link={label:"", url:""}){
    const tpl = document.getElementById("linkTpl").content.cloneNode(true); const row = tpl.querySelector(".link-item");
    row.querySelector(".link-label").value = link.label||""; row.querySelector(".link-url").value = link.url||"";
    row.querySelector(".link-del").addEventListener("click", ()=> row.remove());
    linksList.appendChild(tpl);
  }

  function fillForm(from){
    titleInput.value=from.pageTitle||""; loadingMsgInput.value=from.loadingText||"";
    nameInput.value=from.name||"";
    bgInput.value     = isDataImage(from.backgroundUrl) ? from.backgroundUrl : "";
    bannerInput.value = isDataImage(from.bannerUrl)     ? from.bannerUrl     : "";
    profileInput.value= isDataImage(from.profileUrl)    ? from.profileUrl    : "";
    loadingBgInput.value=from.loadingBg || DEFAULTS.loadingBg;
    loadingDotInput.value=from.loadingDot || DEFAULTS.loadingDot;
    if(/^#/.test(loadingBgInput.value))  loadingBgPicker.value  = loadingBgInput.value;
    if(/^#/.test(loadingDotInput.value)) loadingDotPicker.value = loadingDotInput.value;
    overlayColorInput.value   = from.overlayColor   || DEFAULTS.overlayColor;
    cardShadowColorInput.value= from.cardShadowColor|| DEFAULTS.cardShadowColor;
    if(/^#/.test(overlayColorInput.value))   overlayColorPicker.value   = overlayColorInput.value;
    if(/^#/.test(cardShadowColorInput.value)) cardShadowColorPicker.value= cardShadowColorInput.value;

    tagsList.innerHTML=""; (from.tags||[]).forEach(addTagRow);
    linksList.innerHTML=""; (from.buttons||[]).forEach(addLinkRow);

    const metaSlug = from?.meta?.slug;
    if (metaSlug) {
      slugInput.value = metaSlug;
      localStorage.setItem(SLUG_KEY, metaSlug);
    }
  }

  function collectForm(){
    const tags = [...document.querySelectorAll(".tag-item")].map(el=>{
      const text   = el.querySelector(".tag-text").value.trim();
      const clsVal = el.querySelector(".tag-color").value;
      const codeVal= el.querySelector(".tag-color-code").value.trim();
      const color  = codeVal || clsVal || "tag-gray";
      const shadowColor = el.querySelector(".tag-shadow-code").value.trim();
      return { text, color, shadowColor };
    }).filter(t=>t.text);

    const buttons = [...document.querySelectorAll(".link-item")].map(el=>({
      label: el.querySelector(".link-label").value.trim(),
      url: el.querySelector(".link-url").value.trim()
    })).filter(b=> b.label && isSafeUrl(b.url));

    const bgVal=isDataImage(bgInput.value.trim())?bgInput.value.trim():DEFAULTS.backgroundUrl;
    const bannerVal=isDataImage(bannerInput.value.trim())?bannerInput.value.trim():DEFAULTS.bannerUrl;
    const profileVal=isDataImage(profileInput.value.trim())?profileInput.value.trim():DEFAULTS.profileUrl;

    const cfg = {
      pageTitle: titleInput.value.trim() || nameInput.value.trim() || DEFAULTS.pageTitle,
      loadingText: loadingMsgInput.value.trim() || DEFAULTS.loadingText,
      backgroundUrl:bgVal, bannerUrl:bannerVal, profileUrl:profileVal,
      name: nameInput.value.trim() || DEFAULTS.name,
      loadingBg:  loadingBgInput.value.trim()  || DEFAULTS.loadingBg,
      loadingDot: loadingDotInput.value.trim() || DEFAULTS.loadingDot,
      overlayColor: overlayColorInput.value.trim() || DEFAULTS.overlayColor,
      cardShadowColor: cardShadowColorInput.value.trim() || DEFAULTS.cardShadowColor,
      tags, buttons
    };

    const slugVal = slugInput.value.trim();
    if (slugVal) cfg.meta = { ...(cfg.meta||{}), slug: slugVal };

    return cfg;
  }

  function bindFileInput(fileEl, targetInput, after){
    fileEl?.addEventListener("change", e=>{
      const f=e.target.files?.[0]; if(!f) return;
      const url = URL.createObjectURL(f);
      let k = (targetInput===bgInput)?'bg':(targetInput===bannerInput)?'banner':'profile';
      __openCrop(url, k, function(dataURL){
        targetInput.value = dataURL;
        if (typeof after === "function") try{ after(dataURL); }catch{}
        try{ render(collectForm()); saveDraftDebounced(); }catch{}
      });
    });
  }
  bindFileInput(bgFile, bgInput, ()=>{});
  bindFileInput(bannerFile, bannerInput, ()=>{});
  bindFileInput(profileFile, profileInput, (dataURL)=>{ $("#profileImg").src = dataURL; });

  loadingBgPicker?.addEventListener("input", e=>{ loadingBgInput.value = e.target.value; render(collectForm()); saveDraftDebounced(); });
  loadingDotPicker?.addEventListener("input", e=>{ loadingDotInput.value = e.target.value; render(collectForm()); saveDraftDebounced(); });
  overlayColorPicker?.addEventListener("input", e=>{ overlayColorInput.value = e.target.value; render(collectForm()); saveDraftDebounced(); });
  cardShadowColorPicker?.addEventListener("input", e=>{ cardShadowColorInput.value = e.target.value; render(collectForm()); saveDraftDebounced(); });

  document.getElementById("addTagBtn").addEventListener("click", ()=> { addTagRow(); saveDraftDebounced(); });
  document.getElementById("addLinkBtn").addEventListener("click", ()=> { addLinkRow(); saveDraftDebounced(); });
  document.getElementById("previewBtn").addEventListener("click", ()=> { render(collectForm()); saveDraftDebounced(); });

  document.getElementById("saveBtn").addEventListener("click", async ()=>{
    const c = collectForm();
    localStorage.setItem(LS_KEY, JSON.stringify(c));
    const sv = (c.meta && c.meta.slug) ? c.meta.slug : slugInput.value.trim();
    if (sv) localStorage.setItem(SLUG_KEY, sv);

    render(c);
    const enc = encodeCfg(c);
    const u = new URL(location.href);
    if (enc.length <= LENGTH_LIMIT) u.searchParams.set("c", enc);
    else u.searchParams.delete("c");
    history.replaceState(null,"",u);

    if (CLOUD_READY && currentUser) { await saveToAccountRemote(c); }
    alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    openPanel(false);
    clearDraft(); // ì €ì¥ í›„ ì„ì‹œì´ˆì•ˆ ì œê±°
  });

  document.getElementById("resetBtn").addEventListener("click", ()=>{
    if(confirm("ëª¨ë“  ì„¤ì •ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ë˜ëŒë¦´ê¹Œìš”?")){
      localStorage.setItem(LS_KEY, JSON.stringify(DEFAULTS));
      fillForm(DEFAULTS); render(DEFAULTS);
      const u=new URL(location.href); u.searchParams.delete("c"); history.replaceState(null,"",u);
      alert("ì´ˆê¸°í™”í–ˆìŠµë‹ˆë‹¤.");
      clearDraft();
    }
  });

  document.getElementById("exportBtn").addEventListener("click", ()=>{
    const blob = new Blob([JSON.stringify(collectForm(),null,2)], {type:"application/json"});
    const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download="panel-config.json"; a.click();
    URL.revokeObjectURL(a.href);
  });

  document.getElementById("importBtn").addEventListener("click", ()=>{
    const inp=document.createElement("input"); inp.type="file"; inp.accept="application/json";
    inp.onchange=()=>{ const f=inp.files[0]; if(!f) return;
      const r=new FileReader();
      r.onload=()=>{ try{ const c=JSON.parse(r.result); fillForm(c); render(c); alert("ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ. ì €ì¥ì„ ëˆŒëŸ¬ ë°˜ì˜í•˜ì„¸ìš”."); saveDraftDebounced(); }catch{ alert("ì˜ëª»ëœ JSON íŒŒì¼ì…ë‹ˆë‹¤."); } };
      r.readAsText(f);
    };
    inp.click();
  });

  document.getElementById("shareLinkBtn").addEventListener("click", async ()=>{
    const encoded = encodeCfg(collectForm());
    if (encoded.length > LENGTH_LIMIT) { alert("ë§í¬ê°€ ë„ˆë¬´ ê¸¸ì–´ìš”. â€˜ì§§ì€ ë§í¬â€™ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."); return; }
    const url = new URL(location.href); url.searchParams.set("c", encoded);
    const ok = await copyText(url.toString());
    if(!ok) prompt("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆì–´ìš”. ì•„ë˜ ë§í¬ë¥¼ ì§ì ‘ ë³µì‚¬í•˜ì„¸ìš”:", url.toString());
    const clean = new URL(location.href); clean.searchParams.delete("c"); history.replaceState(null,"",clean);
  });

  async function saveToAccountRemote(cfg){
    const { data:{ user } } = await supabase.auth.getUser();
    if(!user) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
    const s = slugInput.value.trim();
    if (s) cfg.meta = { ...(cfg.meta||{}), slug: s };

    const { error } = await supabase.from("configs").upsert({ user_id:user.id, data:cfg });
    if (error) return alert("í´ë¼ìš°ë“œ ì €ì¥ ì‹¤íŒ¨: " + error.message);
    alert("í´ë¼ìš°ë“œì— ì €ì¥ ì™„ë£Œ");
  }

  async function loadFromAccountRemote(){
    const { data:{ user } } = await supabase.auth.getUser();
    if(!user) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
    const { data, error } = await supabase.from("configs").select("data").eq("user_id", user.id).single();
    if (error || !data) {
      localStorage.setItem(LS_KEY, JSON.stringify(DEFAULTS));
      fillForm(DEFAULTS); render(DEFAULTS);
      const u=new URL(location.href); u.searchParams.delete("c"); history.replaceState(null,"",u);
      alert("ê³„ì •ì— ì €ì¥ëœ ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤.");
      clearDraft();
    };
    const cfg = data.data;
    fillForm(cfg); render(cfg); localStorage.setItem(LS_KEY, JSON.stringify(cfg));
    const loadedSlug = cfg?.meta?.slug;
    if (loadedSlug) {
      localStorage.setItem(SLUG_KEY, loadedSlug);
      slugInput.value = loadedSlug;
    }
    const u=new URL(location.href); u.searchParams.delete("c"); history.replaceState(null,"",u);
    clearDraft();
  }
  document.getElementById("saveToAccountBtn").addEventListener("click", ()=> saveToAccountRemote(collectForm()));
  document.getElementById("loadFromAccountBtn").addEventListener("click", ()=> loadFromAccountRemote());

  function genCode(n=8){ const chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"; let s=""; for(let i=0;i<n;i++) s+=chars[Math.floor(Math.random()*chars.length)]; return s; }

  async function createShortLink(cfg){
    const { data:{ user } } = await supabase.auth.getUser();
    if(!user){ alert("ì§§ì€ ë§í¬ë¥¼ ë§Œë“¤ë ¤ë©´ ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”."); openAuth(true); return; }
    let ask = prompt("ì§§ì€ ì½”ë“œ(ì˜ë¬¸/ìˆ«ì/ì–¸ë”ë°”/í•˜ì´í”ˆ, 4~32ì). ë¹„ìš°ë©´ ìë™ ìƒì„±ë©ë‹ˆë‹¤.","");
    ask = (ask||"").trim();
    if(ask && !/^[a-zA-Z0-9_-]{4,32}$/.test(ask)){ alert("í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì•„ìš”."); return; }
    const code = ask || genCode(8);
    const { data, error } = await supabase.from("short_configs").upsert({ code, owner_id: user.id, data: cfg }).select("code").single();
    if(error){ alert("ì €ì¥ ì‹¤íŒ¨: "+error.message); return; }
    const shortUrl = `${location.origin}${location.pathname}?s=${encodeURIComponent(data.code)}`;
    const ok2 = await copyText(shortUrl);
    if(!ok2){ prompt("ì§§ì€ ë§í¬ê°€ ë§Œë“¤ì–´ì¡Œì–´ìš”. ì•„ë˜ì—ì„œ ì§ì ‘ ë³µì‚¬í•˜ì„¸ìš”:", shortUrl); }
    else { alert("ì§§ì€ ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n" + shortUrl); }
  }
  async function fetchShortByCode(code){
    const { data, error } = await supabase.from("short_configs").select("data").eq("code", code).single();
    if(error){ console.warn(error.message); return null; }
    return data?.data || null;
  }
  document.getElementById("createShortBtn").addEventListener("click", ()=> createShortLink(collectForm()));

  function isValidSlug(s){ return /^[a-zA-Z0-9_-]{3,32}$/.test(s||""); }
  async function publishSlug(slug, cfg){
    if(!isValidSlug(slug)) return alert("ì˜ë¬¸/ìˆ«ì/_/-, 3~32ìë¡œ ì…ë ¥í•˜ì„¸ìš”.");
    const { data:{ user } } = await supabase.auth.getUser();
    if(!user) return alert("ë¡œê·¸ì¸ í›„ ê²Œì‹œí•  ìˆ˜ ìˆì–´ìš”.");

    const existed = await supabase.from("short_configs").select("owner_id").eq("code", slug).maybeSingle();
    if(existed.data && existed.data.owner_id && existed.data.owner_id !== user.id){
      return alert("ì´ë¯¸ ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ì‚¬ìš© ì¤‘ì¸ ë§í¬ì…ë‹ˆë‹¤.");
    }
    const { error } = await supabase.from("short_configs").upsert({ code: slug, owner_id: user.id, data: cfg }).select("code").single();
    if(error) return alert("ê²Œì‹œ ì‹¤íŒ¨: "+error.message);

    const url = `https://mynameis.r-e.kr/${encodeURIComponent(slug)}`;
    const ok = await copyText(url);

    localStorage.setItem(SLUG_KEY, slug);
    slugInput.value = slug;

    alert(`ê²Œì‹œ ì™„ë£Œ! ${ok ? '(í´ë¦½ë³´ë“œì— ë³µì‚¬ë¨)' : '(ë³µì‚¬ ì‹¤íŒ¨ â€” ì•„ë˜ ë§í¬ë¥¼ ì§ì ‘ ë³µì‚¬)'}\n${url}`);
  }
  document.getElementById("publishSlugBtn").addEventListener("click", ()=>{
    const slug = slugInput.value.trim();
    publishSlug(slug, collectForm());
  });

  /* ===== ì¸ì¦ ===== */
  let currentUser = null;
  const authModal = $("#authModal"), authEmail=$("#authEmail"), authPw=$("#authPw");
  const loginBtn=$("#loginBtn"), registerBtn=$("#registerBtn"), logoutBtn=$("#logoutBtn"), authClose=$("#authClose");
  const sendResetBtn = $("#sendResetBtn");
  const pwModal = $("#pwModal"), pwClose = $("#pwClose"), newPw1=$("#newPw1"), newPw2=$("#newPw2"), pwUpdateBtn=$("#pwUpdateBtn");
  function openAuth(o=true){ authModal.classList.toggle("open", o); if(o){ authEmail.focus(); } }
  function openPw(o=true){ pwModal.classList.toggle("open", o); if(o){ newPw1.focus(); } }
  authClose.addEventListener("click", ()=> openAuth(false));
  pwClose.addEventListener("click", ()=> openPw(false));
  authToggle.addEventListener("click", ()=>{
    if(currentUser){
      $("#authTitle").textContent = "ê³„ì • ì •ë³´";
      authEmail.value = currentUser; authEmail.disabled = true; authPw.value = "";
      logoutBtn.style.display = ""; registerBtn.style.display = "none";
      loginBtn.textContent = "ì¬ë¡œê·¸ì¸"; openAuth(true);
    } else {
      $("#authTitle").textContent = "ë¡œê·¸ì¸ / íšŒì›ê°€ì…";
      authEmail.value = ""; authEmail.disabled = false; authPw.value = "";
      logoutBtn.style.display = "none"; registerBtn.style.display = "";
      loginBtn.textContent = "ë¡œê·¸ì¸"; openAuth(true);
    }
  });
  registerBtn.addEventListener("click", async ()=>{
    const email = authEmail.value.trim(); const pw = authPw.value;
    if(!email || !pw) return alert("ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    const { error } = await supabase.auth.signUp({ email, password: pw, options: { emailRedirectTo: window.location.origin + window.location.pathname } });
    if (error) return alert(error.message);
    alert("íšŒì›ê°€ì… ë©”ì¼ì„ ë³´ëƒˆì–´ìš”. ì¸ì¦ í›„ ë¡œê·¸ì¸í•˜ì„¸ìš”.");
    openAuth(false);
  });
  loginBtn.addEventListener("click", async ()=>{
    const email = authEmail.value.trim(); const pw = authPw.value;
    if(!email || !pw) return alert("ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    const { data, error } = await supabase.auth.signInWithPassword({ email, password: pw });
    if (error){
      const msg = (error.message || "").toLowerCase();
      if (msg.includes("confirm") || msg.includes("verified") || msg.includes("not confirmed")){
        alert("ì´ë©”ì¼ ì¸ì¦ì„ ì™„ë£Œí•´ì•¼ ë¡œê·¸ì¸í•  ìˆ˜ ìˆì–´ìš”.");
      } else { alert(error.message); }
      return;
    }
    currentUser = data.user.email; sessionPill.textContent=`ë¡œê·¸ì¸: ${currentUser}`; sessionPill.style.display="";
    try{ await loadFromAccountRemote(); }catch{}   <!-- â˜… ì¶”ê°€: ë¡œê·¸ì¸ ì§í›„ ê³„ì •ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸° -->
    openAuth(false);
  });
  logoutBtn.addEventListener("click", async ()=>{
    await supabase.auth.signOut(); currentUser=null; sessionPill.style.display="none"; openAuth(false);
  });
  sendResetBtn.addEventListener("click", async ()=>{
    const email = (authEmail.value||"").trim(); if(!email) return alert("ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.");
    const { error } = await supabase.auth.resetPasswordForEmail(email, { redirectTo: window.location.origin + window.location.pathname });
    if (error) return alert(error.message);
    alert("ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë©”ì¼ì„ ë³´ëƒˆì–´ìš”.");
  });

  supabase.auth.getSession().then(({ data })=>{
    const user = data.session?.user;
    if (user) { currentUser=user.email; sessionPill.textContent=`ë¡œê·¸ì¸: ${user.email}`; sessionPill.style.display=""; }
  });
  supabase.auth.onAuthStateChange((event, session)=>{
    if (event === "PASSWORD_RECOVERY"){ openAuth(false); openPw(true); return; }
    const user = session?.user;
    if (user) { currentUser=user.email; sessionPill.textContent=`ë¡œê·¸ì¸: ${user.email}`; sessionPill.style.display=""; }
    else { currentUser=null; sessionPill.style.display="none"; }
  });

  /* ===== ë¶€íŒ… (ìŠ¬ëŸ¬ê·¸ ë¡œë”© ìŠ¤íƒ€ì¼ ì„ ë°˜ì˜ + í´ë°±) ===== */
  (async ()=>{
    const safeClose = window.__closeLoading || (()=>{});
    try {
      const url = new URL(location.href);

      function getSlug(){
        let slug = url.searchParams.get("s");
        if (!slug) {
          const segs = location.pathname.split('/').filter(Boolean);
          const last = segs[segs.length-1] || "";
          const m = last.match(/^@?([A-Za-z0-9_-]{3,32})$/);
          if (m) slug = m[1];
        }
        return slug;
      }

      const sleep = (ms)=> new Promise(r=>setTimeout(r, ms));
      async function withTimeout(promise, ms){ return await Promise.race([ promise, sleep(ms).then(()=>null) ]); }

      const slug = getSlug();
      let cfg = null;

      // ë¡œê·¸ì¸ ì„¸ì…˜ í™•ì¸ (ê¸°ë³¸ ë§í¬ì—ì„œ ë¹„ë¡œê·¸ì¸ ì‹œ ê¸°ë³¸ íŒ¨ë„ ê°•ì œ)
      let __hasSession = false;
      try {
        const __sess = await supabase.auth.getSession();
        __hasSession = !!(__sess && __sess.data && __sess.data.session && __sess.data.session.user);
      } catch(e) { __hasSession = false; }

      // ===== View-only when visiting a user slug =====
      const VIEW_ONLY = !!slug;
      if (VIEW_ONLY) {
        const fab = document.querySelector('.fab');             // ë¡œê·¸ì¸/ì„¤ì • ë¬¶ìŒ
        if (fab) fab.style.display = 'none';                    // í‘œì‹œ ì•ˆ í•¨
        const sp = document.getElementById('settingsPanel');    // ì„¤ì • íŒ¨ë„
        if (sp) sp.style.display = 'none';                      // í‘œì‹œ ì•ˆ í•¨
        const myBtn = document.getElementById('myPanelBtn');    // ìš°ì¸¡ ìƒë‹¨ ë²„íŠ¼ ë…¸ì¶œ
        if (myBtn) myBtn.style.display = 'inline-block';
      }

      // 1) ë¡œë”© í™”ë©´ ìŠ¤íƒ€ì¼ë§Œ ë¨¼ì € ë°˜ì˜(ìµœëŒ€ 800ms)
      if (slug && typeof fetchShortByCode === "function") {
        const early = await withTimeout(fetchShortByCode(slug).catch(()=>null), 800);
        if (early) applyLoadingStyle(early);
        cfg = early;
      }

      // 2) ì „ì²´ ì„¤ì • í™•ë³´(ìµœëŒ€ 1200ms)
      if (!cfg && slug && typeof fetchShortByCode === "function") {
        cfg = await withTimeout(fetchShortByCode(slug).catch(()=>null), 1200);
      }

      // 3) ?c íŒŒë¼ë¯¸í„° (ìŠ¬ëŸ¬ê·¸ í˜ì´ì§€ì—ì„œëŠ” ë¬´ì‹œ / ë¹„ë¡œê·¸ì¸ ê¸°ë³¸ë§í¬ì—ì„œëŠ” ë¬´ì‹œ)
      if (!cfg && !slug && __hasSession) {
        const c = url.searchParams.get("c");
        if (c) {
          cfg = decodeCfg(c);
          try { url.searchParams.delete("c"); history.replaceState(null,"",url); } catch {}
        }
      }

      // 4) localStorage (ìŠ¬ëŸ¬ê·¸ í˜ì´ì§€ì—ì„œëŠ” ë¬´ì‹œ / ë¹„ë¡œê·¸ì¸ ê¸°ë³¸ë§í¬ì—ì„œëŠ” ë¬´ì‹œ)
      if (!cfg && !slug && __hasSession) {
        try{ const raw = localStorage.getItem(LS_KEY); if(raw) cfg = JSON.parse(raw); }catch{}
      }

      // 5) ê¸°ë³¸ê°’
      if (!cfg) cfg = structuredClone(DEFAULTS);

      // 6) ë Œë”
      try { fillForm(cfg); render(cfg); } catch(e){ console.error(e); render(DEFAULTS); }

      // 7) í¸ì§‘ì¤‘ ë³µì›(ì„¸ì…˜ ì„ì‹œì €ì¥) â€” ìŠ¬ëŸ¬ê·¸ í˜ì´ì§€ì—ì„œëŠ” ì—´ì§€ ì•ŠìŒ
      if (!slug) maybeRestoreDraft();

    } catch (e) {
      console.error("boot failed:", e);
      try{ render(DEFAULTS); }catch{}
    } finally {
      safeClose();
    }
  })();
  </script>
<a aria-label="ë‚´ íŒ¨ë„ë¡œ ê°€ê¸°" class="my-panel-btn" href="https://mynameis.r-e.kr/" id="myPanelBtn" title="ë‚´ íŒ¨ë„ë¡œ ê°€ê¸°">ë‚´ íŒ¨ë„ë¡œ ê°€ê¸°</a>
<style>
  .my-panel-btn{
    position:fixed; top:12px; right:12px; z-index:1250;
    display:none; padding:8px 12px; border-radius:8px;
    background:#111; color:#fff; text-decoration:none;
    font-weight:800; font-size:12px; box-shadow:0 6px 18px rgba(0,0,0,.2)
  }
</style>

<script>
(function(){
  try {
    var url = new URL(location.href);
    function __getSlug(){
      var s = url.searchParams.get("s");
      if(!s){
        var segs = location.pathname.split('/').filter(Boolean);
        var last = segs[segs.length-1] || "";
        var m = last.match(/^@?([A-Za-z0-9_-]{3,32})$/);
        if (m) s = m[1];
      }
      return s;
    }
    var slug = __getSlug();
    if (slug) {
      var myBtn = document.getElementById('myPanelBtn');
      if (myBtn) myBtn.style.display = 'inline-block';
    }
  } catch(e){}
})();
</script>


<!-- crop modal -->
<div id="cropModal" role="dialog" aria-modal="true" aria-labelledby="cropTitle">
  <div id="cropBox">
    <div id="cropHead">
      <div id="cropTitle">ì´ë¯¸ì§€ í¬ë¡­</div>
      <button id="cropClose" title="ë‹«ê¸°">âœ•</button>
    </div>
    <div id="cropBody">
      <div id="cropStage">
        <img id="cropImg" alt="í¬ë¡­ ë¯¸ë¦¬ë³´ê¸°"/>
        <div id="selBox" aria-label="ì„ íƒ ì˜ì—­" role="region">
          <div class="sel-h nw" data-dir="nw"></div>
          <div class="sel-h n"  data-dir="n"></div>
          <div class="sel-h ne" data-dir="ne"></div>
          <div class="sel-h e"  data-dir="e"></div>
          <div class="sel-h se" data-dir="se"></div>
          <div class="sel-h s"  data-dir="s"></div>
          <div class="sel-h sw" data-dir="sw"></div>
          <div class="sel-h w"  data-dir="w"></div>
        </div>
      </div>
    </div>
    <div id="cropFoot">
      <button class="crop-btn secondary" id="cropCancel">ì·¨ì†Œ(Esc)</button>
      <button class="crop-btn" id="cropApply">ì ìš©(Enter)</button>
    </div>
  </div>
</div>

</body>
</html>
